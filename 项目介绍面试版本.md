**项目介绍：**

基于 Spring Boot + Vue3 构建的企业级图片协作管理平台。实现多空间隔离的图片存储、实时协同编辑和智能权限控制等核心功能。支持公共图库、私有空间和团队空间的资源隔离，提供完整的用户管理、图片管理、空间管理和数据分析功能，采用分布式架构设计，支持高并发访问和实时协作。

**负责内容：**

1. 基于自研 Spring Boot 项目模板 + MyBatis Plus + MyBatis X 插件快速实现用户、图片、空间等实体表的 CRUD 操作，提升开发效率
2. 设计基于 RBAC 模型的权限控制体系，结合 Spring AOP + ThreadLocal 实现方法级别的权限拦截，实现用户-角色-权限的动态管理和空间资源的访问控制

**相关面试题：**

1. **RBAC 模型相关**

   - 问：请解释 RBAC 权限模型的核心组成部分及其工作原理？
     RBAC 就是基于角色的访问权限控制，有角色，用户，权限，以及他们之间的对应关系，核心思想是每当一个用户进行某项操作时，先给用户分配某项角色，在根据角色和权限的关系，判断用户是否拥有这项操作的权限，这样可以统一项目有关核心资源图片的操作，实现方法级别的权限控制。

   - 问：在你的项目中，如何设计用户-角色-权限的关系表结构？
     目前来说，权限是比较简单的，角色的数量也很少，所以没有明确定义结构关系表，而是根据用户的操作，来使用程序代码逻辑判断用户拥有的操作权限。因为项目中核心控制的权限就是图片，而图片又有空间的划分，所以分配角色的主要依据就是用户操作是所携带的图片 ID 和空间 ID,如果有空间 ID，就认为是空间操作，依据空间权限赋予角色，如果未携带，依据公共图库赋予角色。

   - 问：与 ACL 权限模型相比，RBAC 模型有哪些优势和局限性？
     ACL 提供了细粒度的权限控制，可以精确到每个资源和用户，但当资源增多时，管理复杂度会大幅增加。RBAC 则通过角色来简化权限管理，适用于角色固定且权限需求简单的场景。我们目前的项目资源都是有一个大分类的，没必要做到每一个图片资源都去单独控制访问权限，并且角色的获取逻辑也是固定的，所以选择了 RBAC
     ABAC：基于用户、资源和环境的属性来控制访问，适用于权限控制更为复杂、动态变化的场景。

2. **Spring AOP 实现权限控制**

- 问：你是如何利用 Spring AOP 实现方法级别的权限拦截的？请详细描述实现流程。
  前面提到，权限的角色赋予主要是依靠空间 ID 和 PICTUREID,AOP 首先会读取请求，我们在设计请求参数的时候，对于单独的 ID 类请求是只有一个 idRequest,其他请求都是 PictureId,SpaceId 这种，所以可以拦截请求中的 requestBody 或者 requestParam 来获取这些请求资源的上下文，将其封装为统一的对象，之后，根据当前登录的用户以及请求上下文和定义的用户-角色-权限关系，给用户分配角色，之后于自定义注解中传入的需要的访问角色进行比对，查看角色是否拥有这项操作的权限，以此进行拦截，注解主要定义了 ADMIN,VIEWER.EDITOR 三项权限，最后将自定义注解写入就行了。

- 问：在权限拦截中，你使用了哪些注解？它们的作用是什么？
- 问：如何处理嵌套方法调用时的权限问题？
  因为是基于注解的，每次访问一个资源操作都会赋予角色，这个角色是固定的，只要我嵌套的方法也使用注解规定了需求的角色，也会被代理拦截进行校验。

1. **ThreadLocal 应用**

   - 问：在权限控制中，ThreadLocal 的作用是什么？为什么选择使用它？
     这里的 localThread 主要是再拦截器中定义的，Interceptor 前置拦截器拿到 session->获取用户信息->保存到 localThread 中，请求的后续需要用户信息就直接本地拿，不需要再去 session（redis）中读取，后置拦截器再 remove 掉这个信息防止内存泄漏。
   - 问：在分布式环境下，ThreadLocal 的局限性是什么？你如何解决？

2. **权限设计与实现**
   - 问：你的项目中如何实现动态权限管理？权限变更后如何立即生效？
   - 问：在处理空间资源访问控制时，你是如何区分不同空间的权限边界的？
   - 问：你的权限系统如何应对高并发场景？有哪些性能优化措施？
3. 集成腾讯云 COS 对象存储和数据万象服务，采用模板方法设计模式实现统一的图片上传处理流程，支持本地图片和 URL 图片的智能处理

**相关面试题：**

1. **对象存储与 CDN**

   - 问：腾讯云 COS 对象存储的主要特点是什么？与传统文件存储相比有哪些优势？
   - 问：在项目中如何处理图片上传的安全性问题？如何防止未授权访问？
   - 问：如何优化大文件上传体验？你实现了哪些机制？

2. **模板方法设计模式**

   - 问：请详细解释你如何应用模板方法设计模式实现图片上传处理流程？
     首先是获取文件对象，File 对象，如果是本地上传对应的就是将 MutileFile 转成 file,URL 就是对应校验 url 合理性然后下载 url 资源到本地，然后就是获取文件的元信息，
   - 问：在你的实现中，模板方法的抽象步骤和具体步骤分别是什么？
     先实现两套，然后给统一部分放到抽象模板方法类中，差异部分设计为抽象方法交由不同的实现子类去实现
   - 问：与策略模式相比，为什么在此场景选择模板方法模式？有什么优势？

- 同上

1. **图片处理服务**
   - 问：腾讯云数据万象服务提供了哪些图片处理能力？你在项目中使用了哪些？
   - 问：如何处理不同来源（本地上传 vs URL）图片的差异化处理逻辑？
     模板方法同上
   - 问：在图片处理过程中，你是如何优化性能的？有哪些技术手段？
2. 使用 Redis+Caffeine 构建多级缓存，提高主页热门图片查询性能，实现接口响应耗时降低 400%，设置随机过期时间降低缓存雪
   崩风险
3. 运用 Redis Zset + Lua +布隆过滤器 + AOP+线程池技术，实现动态热 key 缓存和 LRU 缓存淘汰策略，灵活应对访问流量高峰

**相关面试题：**

1. **多级缓存架构**

   - 问：请详细描述 Redis+Caffeine 5 分钟 多级缓存的工作原理和数据流转过程？
     查本地缓存->存在就返回->查 redis->存在就返回最后查询数据库，这里的 redis 过期时间设计的比较长（10 分钟），当作是冷数据的访问，caffeine 当做热数据的访问，最后用 mysql 作为算是兜底，都没有就放入 mysql,查到数据也会向上添加进缓存。

   - 问：多级缓存带来了哪些挑战？你是如何解决缓存一致性问题的？
     项目里面的因为缓存 key 的生成是将查询条件作为生成缓存 key 的条件，先使用对象转换成 json 再使用 md5digest 转换为 key,所以如果单独的一张图片发送修改，是无法准确的判断应该让哪一个缓存失效，或者可能有很多的缓存失效，所以我们是在这个业务背景下，允许主页查询的图片列表（不存在 图片详细信息）有一定的时间内是处于不一致的，也就是强调高可用牺牲一致性，最后当数据过期之后再重建缓存还是会保证最终一致性的。

1. **缓存策略与优化**

   - 问：你提到接口响应时间降低 400%，请解释你是如何测量和优化的？
     写了两套接口，一套使用缓存，另一套没有使用缓存使用 APIPOST 对同样的查询参数做相同次数的压测
   - 问：随机过期时间如何帮助降低缓存雪崩风险？具体实现方式是什么？
     缓存雪崩指的是同一时间大量的缓存 key 同时过期，导致大量的请求直接打到数据库导致数据库承受不住，然后崩掉，那么主要的发生原因是大量的缓存 key 同时过期，所以我们可以分散缓存过期的时间，使得缓存过期时间尽量分散，所以采用在固定时间的基础上添加了一定随机范围的时间浮动设置随机缓存。
   - 问：在缓存设计中，你如何平衡命中率和内存占用？
     主要是通过设置合理的缓存容量和过期策略来平衡，在对单独的图像详细信息的查询接口中，自己使用了一套 Redis Zset +Lua 基于 LRU 的缓存淘汰策略，并且实现了 AOP 对于不同的方法可以使用注解来快速实现，首先 Zset 存储的是需要缓存的数据 id 和它最近一次访问的时间搓作为分数（升序排序）限制了整个缓存能够存储的数据条数比如系统实现的是 1000，线程池主要是用来将前 50 条数据异步加载到本地缓存 Caffeine 中的.5 分钟执行一次(newScheduledThreadPool,指定时间周期)。(使用 Sc)

1. **热点数据处理**

   - 问：请详细解释你如何使用 Redis Zset 实现动态热 key 缓存？
   - 问：Lua 脚本在你的缓存实现中起到什么作用？为什么不使用普通 Redis 命令？
   - 问：布隆过滤器如何帮助你优化缓存性能？在哪些场景下使用它？
     主要是为了防止缓存穿透，因为上述的实现，如果使用缓存空值的方式去处理缓存传统的问题，可能 1000 条缓存中间会存在大量的 null 值，并且存到 caffeine 的缓存也会有大量的空值，占用了大量的缓存空间，所以选择布隆过滤器。

1. **并发与性能**

   - 问：在高并发场景下，你的缓存系统可能面临哪些挑战？如何应对？

   - 问：线程池在缓存更新中的作用是什么？如何配置线程池参数？

基于 synchronized 锁和 TransactionTemplate 编程式事务实现空间资源的并发控制，有效防止事务失效，确保多用户操作时
的数据一致性

**相关面试题：**

1. **并发控制实现**

   - 问：为什么在项目中同时使用 synchronized 锁和 TransactionTemplate？它们各自解决了什么问题？
         主要是防止用户反复提交创建空间的表单提交，同时有两条创建请求，导致只允许一个创建一个类型的空间却创建了两个，是使用用户 ID 做为 synchronized 的锁对象，使用 TransactionTemplate 是防止 synchronized 结束但是事务还没有提交导致的锁失效问题。


   - 问：你是如何确保 synchronized 锁在分布式环境下的有效性？有什么局限性需要注意？
   - 问：在项目中，你遇到过事务失效的情况吗？是如何解决的？

2. **事务管理策略**

   - 问：为什么选择 TransactionTemplate 而不是声明式事务？这种方式有什么优势？
   - 问：你是如何处理事务边界和事务传播行为的？有哪些最佳实践？
   - 问：在高并发场景下，你如何优化事务性能？采取了哪些措施？

3. **资源竞争处理**

   - 问：在你的项目中，具体是哪些空间资源需要并发控制？为什么？
   - 问：你如何平衡并发控制的粒度与系统性能？有没有遇到性能瓶颈？
   - 问：你是如何处理死锁风险的？有哪些预防和检测机制？

4. 设计 WebSocket + Redis 分布式编辑锁机制实现多人实时协作编辑功能，引入 Disruptor 无锁队列处理 WebSocket 消息，显著提升系统消息处理能力

**相关面试题：**

1. **实时协作编辑实现**

   - 问：WebSocket 在实时协作编辑中扮演什么角色？如何处理连接中断的情况？
   - 问：分布式编辑锁的实现原理是什么？如何解决多用户同时编辑的冲突问题？
   - 问：你是如何保证编辑操作的实时性和一致性的？有哪些技术挑战？

2. **消息处理优化**

   - 问：为什么选择 Disruptor 而不是传统的消息队列？它的优势是什么？
     Disruptor 相比传统消息队列有几个关键优势：1) 极低的延迟，通过环形缓冲区和内存预分配减少GC压力；2) 高吞吐量，在我们的WebSocket消息处理场景中能达到传统队列10倍以上的性能；3) 无锁设计，通过CAS操作和内存屏障避免了锁竞争；4) 支持多生产者多消费者模式，适合我们的协作编辑场景。

   - 问：Disruptor 无锁队列的工作原理是什么？如何提高并发性能？
     Disruptor核心是环形缓冲区(RingBuffer)结构，通过序列(Sequence)对象追踪生产和消费位置。它使用内存预分配避免动态分配，采用填充缓存行(Cache Line Padding)防止伪共享，并通过CAS操作和内存屏障代替传统锁，实现无锁并发。我们通过批处理(Batch Processing)、事件处理器链(EventHandlerChain)和多线程消费者组(WorkerPool)配置优化了并发性能。

   - 问：在高并发场景下，你如何监控和调优 WebSocket 消息处理性能？
     我们实现了多层次监控：1) 应用层面使用Micrometer收集Disruptor关键指标(环形缓冲区使用率、消息处理延迟等)；2) JVM层面监控GC情况和线程状态；3) 系统层面监控CPU、内存使用率。调优方面，我们优化了事件处理器链结构，调整了RingBuffer大小和WaitStrategy(从BlockingWait改为YieldingWait)，并实现了动态调整消费者线程数的机制，根据系统负载自动扩缩容。

3. **分布式系统协同**

   - 问：在分布式环境下，你如何确保多个服务节点之间的消息同步？
   - 问：Redis 在分布式编辑锁中的具体作用是什么？为什么选择 Redis？
   - 问：系统扩展时可能面临哪些挑战？你是如何解决的？

4. 基于 Spring AOP + Redisson RateLimiter 实现高可用的限流方案，通过自定义 @RequestLimit 注解实现 用户级别 AI 接口
   的精确限流控制，且预留后续 VIP 用户提供差异化的调用额度的商业化扩展点

**相关面试题：**

1. **限流方案设计**

   - 问：为什么选择 Redisson RateLimiter 实现限流？与其他限流方案相比有什么优势？
   - 问：Spring AOP 在限流实现中扮演什么角色？如何与 Redisson RateLimiter 结合？
   - 问：你的限流方案如何保证高可用性？有哪些容错机制？

2. **注解式限流实现**

   - 问：@RequestLimit 注解的设计思路是什么？包含哪些关键参数？
   - 问：如何实现用户级别的精确限流控制？用户身份是如何识别的？
   - 问：在处理限流异常时，你采取了哪些用户体验优化措施？

3. **商业化扩展设计**
   - 问：差异化调用额度的设计思路是什么？如何实现不同 VIP 等级的限流策略？
   - 问：如何确保限流策略的动态调整不影响系统稳定性？
   - 问：在实际运行中，你如何监控和评估限流效果？使用了哪些指标？
